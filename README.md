# Simple Authorization Service

Этот проект представляет собой **простой сервис авторизации**, написанный на Go с соблюдением хороших практик и использованием популярного набора инструментов. Код демонстрирует механизмы аутентификации/регистрации, подтверждения учётных записей через одноразовые коды, а также работу с асинхронной отправкой email и миграциями базы данных. Проект легко разворачивается с помощью Docker.

## Основные возможности

1. **Авторизация и регистрация**  
   - Использует **[Gin](https://gin-gonic.com/)** в качестве HTTP-фреймворка (роутинг, middleware).
   - Возможность выдавать **JWT** или **PASETO** для дальнейших запросов к защищённым эндпоинтам.
   - Хранение пользователей в PostgreSQL, валидация полей и проверка учётных данных.

2. **Асинхронная отправка Email**  
   - После регистрации пользователь получает письмо с кодом активации.
   - Отправка письма происходит асинхронно (goroutine), чтобы не блокировать основной поток.

3. **Подтверждение учётной записи через Redis**  
   - Генерируется одноразовый код (OTP), сохраняется в Redis с ограниченным временем жизни (TTL).
   - При активации (ввод кода) сервис проверяет Redis и подтверждает учётку в базе.

4. **Docker и docker-compose**  
   - Имеется **Dockerfile** для сборки Go-приложения.
   - **docker-compose.yml** поднимает PostgreSQL, Redis и само приложение.

5. **Golang-migrate**  
   - SQL-файлы миграций размещены в папке `migrations/`.
   - Позволяет выполнять команды `up`, `down`, `drop` и т. д. для управления схемой БД.

6. **Конфигурация через cleanenv**  
   - YAML-файл + ENV-переменные (ENV имеет приоритет).
   - Настройки для Postgres, Redis, SMTP, порты, логирование и т. д.

7. **Структурированное логирование Zerolog**  
   - JSON-формат логов, различные уровни (debug, info, error).

8. **Gomail**  
   - Отправка писем по SMTP (код подтверждения, приветственные сообщения).
   - Можно хранить SMTP-пароль в переменных окружения.

9. **JWT или PASETO**  
   - Есть возможность (через пакеты в `pkg/tokens`) использовать токены для авторизации.

---

## Структура проекта

```bash
backend/
├── cmd/
│   └── app/
│       └── main.go          # Точка входа (Go)
├── config/
│   └── config.yaml          # Конфигурация
├── internal/
│   ├── adapters/            # Подключение к внешним сервисам (например, EmailAdapter)
│   ├── app/                 # Инициализация и управление жизненным циклом приложения
│   ├── errcode/             # Коды ошибок
│   ├── models/              # Сущности домена (User, ...)
│   ├── repositories/        # Работа с PostgreSQL
│   ├── services/            # Бизнес-логика (UserService и т. д.)
│   └── transport/
│       └── http/            # Gin handlers, маршруты
├── migrations/              # SQL-миграции golang-migrate
├── pkg/
│   ├── app_errors/          # Определения и структуры ошибок
│   ├── async/               # AsyncRunner, goroutines + WaitGroup
│   ├── email/               # Gomail + логика отправки
│   ├── logger/              # Zerolog инициализация
│   ├── postgres/            # Обёртка над pgx
│   ├── redis/               # Redis client
│   ├── tokens/              # JWT/PASETO (по желанию)
│   └── validator/           # Дополнительные функции валидации
├── Dockerfile               # Сборка Go-приложения
├── docker-compose.yml       # Поднимает Postgres, Redis, приложение
├── go.mod
├── go.sum
└── README.md                # Текущее руководство
```
